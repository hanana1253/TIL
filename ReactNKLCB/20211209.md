# React

## degit
- svelte 창시자 Rich Harris가 만든 github repository 복사하는 패키지
- git clone과 다른 점은, 레포의 폴더와 파일들을 복사만 하고 git history는 가져오지 않기 때문에 훨씬 더 빠르고, 이미 git으로 관리되고 있는 폴더에서 충돌 없이 다른 레포의 자원을 가져와 쓸 수 있다.
- `$ npx degit {githubusername/repotitle/pathinsiderepo#branchname} {localpath}` 
  - username, repository path, branch name을 통해 public repo의 자원을 다운받을 수 있다. 
  - localpath를 쓰지 않으면 레포 이름과 동일한 폴더로 생성되어 그 안에 저장된다.
  - localpath가 없는 폴더이면 새로운 폴더를 생성하며 그 안에 레포 내용물을 넣어준다.
  - 나의 private repo인 경우 옵션 `--mode=git`(default mode는 tar)을 통해 복제가 가능하긴 한데 조금 느리다.

## RandomCountUp Application (cont.)

### Web API(getUserMedia)로 소리 넣기
- 0부터 정해진 랜덤 숫자까지 올라가면서 wiggle이라는 애니메이션 효과를 넣는 애플리케이션을 만들었다.
- 이제는 여기에 오디오를 넣어주기 위해 getUserMedia라는 web API를 사용해보자.
- index.html에 `<audio id="bgm" src="/assets/bgm-count.mp3" controls autoplay></audio>`로 자동재생되게 해보자.
  - 자동재생이 되면 안된다. 왜냐하면 사용자경험과 접근성, 그리고 자동로드로 인한 무분별한 데이터 사용을 막기 위해 브라우저 정책 상 막아두었기 때문이다. 
  - 하지만 web API로 자동재생설정 의향을 유저에게 묻고 이후에는 자동재생을 해주는 API가 있으니 바로 `MediaDevices.getUserMedia` 이다. 
  - 사용자의 승인을 받은 후 그 도메인에는 계속 자동재생 설정대로 해준다.
- index.html에서 script 태그 안에서 이 API를 써주자.
  - getUserMedia는 promise를 반환하며, 트랙을 순환하기 위해 들어오는 데이터인 stream을 후속처리메서드에서 받아 활용할 수 있다. 우리는 여러 트랙을 가진 오디오가 아니기 때문에 필요 없다.
```js
// index.html script 태그 내부
window.navigator.mediaDevices.getUserMedia({ audio: true }).then( stream => {
    console.log('오디오 재생 가능');
}).catch(({ message }) => {
    console.error(message);
})
```
- 이제 브라우저에서 사용자에게 오디오 허용 권한을 묻는 알림을 띄우고, 허용하면 then 후속처리메서드가 실행된다. 
- 이 후속처리 메서드 안에서 이제 bgm을 재생시키는 로직을 써주자.
```js
window.navigator.mediaDevices.getUserMedia({ audio: true }).then( stream => {
    console.log('오디오 재생 가능');
    const bgmNode = document.getElementById('bgm');
    bgmNode.play();
}).catch(({ message }) => {
    console.error(message);
})
```
- play가 잘 되는데, 영원히 재생되고 있다. 이제 조건처리를 통해 pause를 해주어야 한다.
- 먼저 audio 태그를 build할 때 생성해주게 하기 위해 index.html에서 지우고, autoPlaySound라는 API를 직접 만들자.
  - 카운트 넘버를 문서 title로 세팅해주고, reload 해주는 로직이 있었던 utils/settings.js에서 관리해주자.
```js
// src/utils/settings.js
export const settings = {
    clickDocumentReloadBrowser() {
        document.addEventListener('click', () => window.location.reload());
    },
    setDocumentTitle(newTitle) {
        document.title = newTitle;
    },
    autoPlaySound(src, callback, id='bgm') {
        document.body.insertAdjacentHTML('beforeend', `<audio id=${id} src=${src} loop></audio>`);
    }
}

// src/index.js

settings.autoPlaySound('/assets/bgm-count.mp3', () => {
    console.log('created audio element node');
});
```
- 이렇게 하고 devserver을 통해 구동한 브라우저에서 개발자도구의 요소 패널을 보면 audio 요소가 생기고 콘솔 패널에서 'created audio element node'가 찍히는 것을 볼 수 있다.