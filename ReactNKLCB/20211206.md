# React

## React 어플리케이션 개발에 적합하지 않은 웹 환경
- 지금까지 우리는 일부러 ESM을 써가면서 브라우저에서 모듈파일들을 로드하도록 했다. 이제 이것이 왜 적합하지 않은지 알아보자.
- 서버를 구동하고 네트워크 패널을 보면 우리가 모듈파일로 서로 의존하게 만들어둔 모든 파일이 로드되는 것을 볼 수 있다.
- 절반가량의 request가 js 파일을 로드하는 요청이다. 지금은 간단한 앱이라 이정도이지만 규모가 커진다면...?
- 게다가 최적화되어있지 않아서 쓰이지 않는 코드들도 모두 로드되고 있으며, 분산되어 있고, 압축되어있지 않다.
  - client 안의 src를 바벨이 컴파일해주는데, 바벨은 번들러가 아니기 때문에 그저 코드를 JSX에서 React.createElement로, 또는 ES6에서 하위버전으로 변환시켜줄 뿐.
- 리액트는 컴포넌트 주도 개발이라 수많은 directory에 js, sass 등의 모듈, 테스트 파일들을 가지고 있을 것이다. 이를 다 하나씩 로드하면 수많은 network resource request로 성능이 안좋아질 수 밖에 없다.
- **브라우저 호환성 문제**: 우린 표준 ESM 지원 브라우저(크롬)를 쓰고 있기에 문제가 없었지만, commonJS나 umd를 써야하는 다른 브라우저 같은 경우에는 node js환경에서의 개발이 필수

### React 어플리케이션을 위한 빌드 과정
1. Bundling: 운영과 유지보수를 위해 번들링이 필요하며, 번들링 없이는 서로 종속된 파일을 제대로 관리하기가 어렵다. 
  - CSS도 preprocessor나 postCSS가 없다면 모든 코드가 하나의 파일에 위치하고 cascading도 엉망이 될 것
  - 웹브라우저 환경에서는 모듈 번들링이 제공되지 않는다.
  - 용량이 큰 파일 1개를 요청하는 게, 작은 파일 5개 요청하는 것보다 낫다.
2. Tree-shaking(roll-up): 불필요한 코드를 걷어내고 필요한 것만 추려내는 기능. 
  - 특히 CSS에서 외부 프레임워크(부트스트랩) 사용 시 unused selector을 걷어내주지 않으면 불필요한 built-in class들을 모두 가져온다.
3. Code splitting: 필요한 부분(페이지)의 리소스만, main과 chunk로 나누어 코드를 효율적으로 분할하는 기술
  - app은 여러 페이지로 이루어져 있을 것, 이를 모두 가져오면 초기 로딩에 너무 많은 시간이 소요된다. 
  - 무한 스크롤 기능이라거나 페이지네이션을 통해 필요한 시점에 chunk 요청하는 lazy loading
4. 코드의 최적화와 source map: 배포용 코드를 개행 없이 묶어 압축하고, 보다 편리한 디버깅을 위해 지도와 같은 source map을 제공한다.

### 프레임워크를 쓰는 이유
- 웹 환경에서도 React 앱 개발을 할 수는 있겠지만, 위와 같은 빌드 기능을 잘 제공해주는데, why not?
- 우리는 먼저 facebook 팀이 만든 create-react-app으로 쉽게 해보고, 이후에 rollup, webpack 설정을 직접 해볼 것.

## Create-React-App

### create-react-app의 특징
- Less to Learn: cra 하나만 알아도 쉽게 리액트 프로젝트를 수행할 수 있다.
- Only One Dependency: Jest 및 온갖 것이 하나로 다 들어있다.
- No lock-in: 봉쇄되어있지 않으므로 필요하면 언제나 마음대로 꺼내 설정할 수 있다.

### cra 시작하기
- create-react-app은 하나의 명령어를 사용하여 쉽게 환경설정을 할 수 있게 하는 패키지
  - React, ReactDOM과 react-scripts가 포함되어있는데, 여기서 react-scripts가 웹팩 등의 모든 설정을 해준다.
  - npx 명령어를 통해 최신 버전으로 프로젝트에 필요한 모든 준비공정을 깔아준다.
- `$ npx create-react-app {프로젝트 이름} --template {템플릿 이름}`으로 프로젝트를 만들며 템플릿을 설정할 수 있다.
  - 템플릿은 일종의 preset으로, npm에 올라가있는 것들을 지정하여 사용할 수 있는데 default로 cra-template이 깔린다. 
  - 프로젝트 이름은 소문자나 `-`, `_`로만 공백 없이 작성하며, 이미 만든 디렉토리를 프로젝트명 및 루트로 사용하고 싶으면 `.`으로 현재 경로만 입력하면 된다.
- 설치 후 scripts를 확인해보자.
  - `start`: webpack-dev-server 개발서버를 구동한다.
  - `build`: 수많은 모듈을 bundle, 압축, 코드분할 해주고 소스맵도 제공하며 배포를 위한 정적 파일을 만들어준다.
  - `test`: jest를 통해 virtual DOM 테스트
  - `eject`: react-scripts 속의 많은 구성파일을 꺼내준다. 공부하거나 커스텀하기 위해 꺼내도 되지만 돌아갈 수 없으니 유의.


### cra로 만든 프로젝트 뜯어보기
- src와 public 디렉토리가 있으며 public 안에는 index.html 와 같은 정적 리소스가 들어있다.
- 네트워크 패널 보면 개발 서버에서 응답된 bundle.js가 있지만 webpack dev server가 응답한 파일이므로 아직 빌드되지 않은 상태
- `$ npm run build` 명령을 통해 sourcemap과 bundle 파일을 만들게 하면 public 폴더에 위 파일들이 생겨난다.
  - `$ npx liveserver build`로 빌드된 파일을 라이브서버에서 구동해볼 수 있다.
- `$ npm test`로 테스트해보면 기본으로 만들어진 테스트를 성공했다는 메시지를 알 수 있다.
- `$ npm run eject`: 웹팩을 비롯한 온갖 패키지들이 목록에 생겨나 패키지 환경설정을 위한 config, scripts 폴더도 생겨났다.

## 툴체인 직접 구성하기 (내가 만드는 Create React App)
