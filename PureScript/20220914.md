# Chapter 14. Domain-Specific Languages

## Chapter Goals & Project Setup
- standard techniques를 사용하여 퓨어스크립트의 DSL(Domain-specific languages)를 적용해보자
- DSL: 특정 문제의 도메인에서의 개발에 잘 맞는 언어를 뜻함
  - 문법과 함수는 그 도메인에서의 아이디어를 표현하기에 가독성이 최대화되는 방향으로 선택.
  - Chapter 11에서 Game 모나드와 관련 행동들은 text adventure game development 도메인에 맞게 구성
  - Chapter 13의 quickcheck 패키지는 generative testing 도메인을 위한 DSL이며, combinators는 테스트 속성을 위한 표현적인 노테이션을 가능케 한다. 
- DSL을 다루기 위한 몇몇 standard techniques를 더 구조적으로 접근해보자.
  - 너희들의 작업에 필요한 실용적인 DSL을 직접 만들어볼 수 있을 정도의 지식을 전달해주지
- HTML 문서 만들기 위한 DSL을 예시로, HTML 문서를 정확히 기술하는 type-safe 언어를 개발해보겠다. 
- free monad를 정의하는 `free` 라이브러리를 사용할 것이다.

## A HTML Data Type
- HTML library의 가장 기본적인 버전은 `Data.DOM.Simple` 모듈에 정의되어 있는데, 이는 다음과 같은 타입 정의를 갖는다.
```purescript
newtype Element = Element
  { name         :: String
  , attribs      :: Array Attribute
  , content      :: Maybe (Array Content)
  }

data Content
  = TextContent String
  | ElementContent Element

newtype Attribute = Attribute
  { key          :: String
  , value        :: String
  }
```
- `Element` 타입은 HTML element를 나타내고, 각 element는 name, attribute 쌍의 배열, 그리고 content로 구성되어있다. content 프로퍼티는 Maybe타입을 사용하여 element는 open or closed라는 것을 나타낸다.
- 주요 함수는 아래와 같이 HTML 요소를 HTML 문자열로 만들어주는 것
```purescript
render :: Element -> String
``` 
- 그러나 이 라이브러리엔 많은 문제가 있다.
  - HTML 문서를 만드는 것은 어렵다. 새로운 요소를 만들 때맏 ㅏ 하나의 record, 그리고 하나의 data constructor이 필요하다
  - element 이름에 오타를 내거나, element가 가질 수 없는 류의 어트리뷰트를 넣거나, open/closed를 잘못 사용하는 등 invalid document를 만들어 낼 수 있다.

## Smart Constructors
- 모듈 사용자에게 데이터 표현을 노출시키기보다 `Element`, `Content`, `Attribute` 데이터 생성자를 가리며 다음과 같이 `element` 함수를 사용하도록 할 수 있다.
```purescript
element :: String -> Array Attribute -> Maybe (Array Content) -> Element
element name attribs content = Element
  { name:      name
  , attribs:   attribs
  , content:   content
  }
```
- `element` 함수를 통해 HTML 요소를 만드는 smart constructor을 만든다.
```purescript
a :: Array Attribute -> Array Content -> Element
a attribs content = element "a" attribs (Just content)

p :: Array Attribute -> Array Content -> Element
p attribs content = element "p" attribs (Just content)

img :: Array Attribute -> Element
img attribs = element "img" attribs Nothing
```
- `Element` 타입만 export할 뿐 데이터 생성자를 export하지 않음으로써 invalid HTML element를 만들 여지를 없앤다.
```purescript
module Data.DOM.Smart
  ( Element
  , Attribute(..)
  , Content(..)

  , a
  , p
  , img

  , render
  ) where
```
  - `Attribute`와 `Content` 타입은 아직까지는 여전히 데이터 생성자(`..`)를 export하고 있지만 이것들도 이제 곧 smart constructor로 고칠 수 있다.
- 이렇게 함으로써 invalid한 name의 HTML element를 만드는 것을 불가능하게 했고, closed element가 content를 갖지 못하도록 했다


## Conclusion


## 소감
- 

## 2022.09.07. 스터디 내용
- 
