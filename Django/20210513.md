# Django 

## 인상 깊은 조언
- 모델을 잘 작성하는 것도 중요하지만 실제로 모델을 우리가 짤 일은 많지 않으니 이미 작성된 모델을 잘 이해하고 ORM을 통해 가져오는 걸 잘 하는 것이 중요.
- 관계를 활용하여 편하게 하려고 RDB를 짜는 거니까, 관계를 잘 이해하자.
- 모델을 짤 때는 신중하고 견고하게 짜야 한다. 잘못 짠 모델에 Data가 들어가면 돌이킬 수 없는 상황이 되므로.

## 지난 시간 복습
- 관계형으로 모델을 만들고 이에 기반하여 입렫뇓 Relational DB에서 ORM(Object-Relational Mapping)으로 구현된 메서드를 사용하여 데이터를 데려오는 것을 해보았다.
- 1:N 모델을 통해 하나의 카테고리에 여러 개의 글, 하나의 반에 여러 명의 학생 등의 관계를 구현

### 1:N 예제 실습

### 좋아요 기능
- 각 유저가 무한대로 좋아요를 누를 수 있는 것도 방법이지만, 일반적인 경우 한 사람은 한 번만 좋아요를 누르거나 취소할 수 있다. 
- Like라는 모델을 만들어 좋아요를 누를 때 생성되게 한다. 
- 댓글 하나에 여러 명이 좋아요를 누를 수 있으므로, 댓글 1, 좋아요 N의 관계로 foreign key 설정한다.
- 한 사람이 여러 개의 댓글에 좋아요를 누를 수 있으므로 Student 1, Like N의 관계로 foreign key를 설정한다.
- N 쪽에서 ForeignKey 필드를 가지고 있으므로 Like에 필드를 정의한다.
```python
class Like(models.Model):
    comment = models.ForeignKey(Comment, on_delete=models.CASCADE, related_name='likes')
    liked_by = models.ForeignKey(Student, on_delete=models.CASCADE, related_name='likes')
    created_at = models.TextField(default=time.time())
```
- 이 경우 '어떤 댓글'과 '누가'에 대한 데이터가 좋아요 누를 때마다 인스턴스가 생겨서 1줄씩 쌓인다
- 한 댓글에 여러 명의 '누가'를 담는 N:N 관계로 나중에 구현해볼 수 있다.

### 쇼핑몰 유저 등급관리
- 이름과 등급, 구매한 물품을 갖는 고객 정보 테이블과, 상품 정보 테이블, 할인율과 연관된 고객 등급 테이블을 만들어 서로 관계를 설정해보자.
- 한 명의 고객은 한 개의 등급을 갖는 반면, 한 등급은 여러 고객을 가질 수 있으므로 등급 1, 고객 N의 1:N 관계
- 아직 N:N 관계를 배우지 않았으니, 한 사람은 한 개의 물건만 살 수 있다고 하자. 그러면  한 상품은 여러개 팔릴 수 있지만 한 명의 고객은 한 상품만 살 수 있으므로 상품 1, 고객 N의 1:N 관계
```python
class Level(models.Model):
    level = models.CharField(max_length=2)
    discount_rate = models.IntegerField(default=0)

class Product(models.Model):
    name = models.CharField(max_length=16)
    price = models.IntegerField()
    created_at = models.TextField(default=time.time())
    is_deleted = models.BooleanField(default=False)

class Customer(models.Model):
    user = models.OneToOneField(User, on_delete=models.CASCADE, related_name='customer')
    level = models.ForeignKey(Level, on_delete=models.SET_NULL, related_name='customers', null=True, blank=True)
    shopped_product = models.ForeignKey(Product, on_delete=models.SET_NULL, related_name='purchased_by', null=True, blank=True)
```
- 등급은 쇼핑몰 정책에서 한 번 정의되고 나면 자주 바뀌지는 않는다. 필드를 정의할 때 choices라는 옵션(어트리뷰트)을 통해 이미 정해진 내용 안에서만 고를 수 있게 할 수 있다.
  - choices에 할당할 수 있는 것은 두 개의 요소를 가진 이터러블을 담은 sequence 객체 또는 여러 값을 인스턴스 변수로 가진 클래스 객체이다.
  - choices가 필드에 주어지면 기본 form 위젯은 select box 형태를 띤다.
  - 등급코드와 등급이름을 문자열로 갖는 튜플로 이루어진 배열 등으로 choices를 넣어준다고 하자
    - DB에는 등급코드가 저장되며 해당 데이터 안의 인스턴스 변수처럼 참조할 수 있다. 
    - 튜플의 두번째 요소인 등급이름은 해당 필드의 값으로 저장되며, 그룹객체로도 저장할 수 있다. 
```python
class Level(models.Model):
    LEVEL_CHOICES = [
	('GR', 'Green'),
	('SV', 'Silver'),
	('GD', 'Gold'),
	('PT', 'Platinum)
    ]
    level = models.CharField(choices=LEVEL_CHOICES, default='GR', max_length=2)
    discount_rate = models.IntegerField(default=0)
```

- 또한 필드의 옵션으로 `validators`라는 어트리뷰트를 넣어주기도 한다. 
  - 어트리뷰트 값으로는 함수가 담긴 배열을 넣어준다. 
  - 이는 이 필드에 입력되는 값이 해당 함수를 에러 없이 통과하는 경우에만 데이터가 생성되게 하는 것으로, 정수만 받거나 존재하는 범위 내의 값만 받는 등으로 쓸 수 있다.
  - 장고에서 기본적으로 제공하는 validator 사용하는게 더 편하다.


### Call by Value

### Call by Address

### Call by Reference

### 메모리 영역

### 파이썬의 값 할당

## 1:N 관계 구현
### 학생조회 페이지에 방명록 기능 만들기
#### 모델 생성 및 템플릿 마크업, 경로 추가
#### 데이터 생성하는 함수 정의
#### 템플릿에서 생성된 데이터 보여주기
## 학생조회 서비스에 마이페이지 만들기

## 느낀 점
- 데이터가 엮여있는 걸 가져다 쓰는 건 재미있다. 
- ORM이 잘 구현되어있어서 너무 편하다.
